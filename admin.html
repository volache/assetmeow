<!-- admin.html -->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>系統管理後台</title>
  <script src="js/api.js"></script>
</head>
<body>
  <h2>初始化</h2>
  <button id="initBtn">初始化系統</button>
  <div id="initStatus"></div>

  <h2>新增使用者</h2>
  <form id="userForm">
    <input placeholder="帳號" id="username" required />
    <input placeholder="密碼" type="password" id="password" required />
    <input placeholder="確認密碼" type="password" id="confirmPassword" required />
    <input placeholder="姓名" id="name" />
    <button type="submit">新增</button>
    <div id="userStatus"></div>
  </form>

  <script>
    document.getElementById("initBtn").onclick = async () => {
      const res = await callGASAPI("initializeSystem");
      document.getElementById("initStatus").textContent = res.message || res.error;
    };

    document.getElementById("userForm").onsubmit = async (e) => {
      e.preventDefault();
      const pwd = password.value;
      const confirm = confirmPassword.value;
      if (pwd !== confirm) return alert("密碼不一致");
      const user = {
        username: username.value,
        passwordHash: await sha256(pwd),
        name: name.value,
        unit: "",
        title: "",
        email: "",
        role: "使用者",
        status: "啟用",
        note: ""
      };
      const res = await callGASAPI("addUser", user);
      document.getElementById("userStatus").textContent = res.message || res.error;
    };
  </script>
</body>
</html>
